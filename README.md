# Bill2Moneywiz

## 项目简介

本项目用于处理支付宝或微信支付导出的账单 CSV 文件，将其格式化为 MoneyWiz 等记账软件更易导入的标准格式。工具可自动识别文件编码，批量处理账单数据，并过滤无效或不计收支的交易记录。

## 功能特性

- **多平台支持**：处理支付宝和微信支付的账单 CSV 文件
- **智能编码识别**：自动检测并兼容多种常见编码格式（UTF-8、GBK、GB18030等）
- **数据过滤**：自动过滤"交易关闭"、"不计收支"、"已全额退款"等无效记录
- **金额处理**：支出金额自动转为负数，收入保持为正数
- **日期格式化**：仅保留交易日期，去除时间部分
- **灵活输出**：支持自定义输出文件路径，默认生成在输入文件同目录下

## 账单获取

在使用本工具前，您需要先从支付宝或微信导出账单CSV文件：

- **支付宝账单获取**（手机端）：[查看详细步骤](https://docs.qianjiapp.com/other/import_guide_alipay_app.html)
- **微信账单获取步骤**：[查看详细步骤](https://docs.qianjiapp.com/other/import_guide_weixin.html)

导出的账单文件通常为CSV格式，可直接用于本工具处理。

## 使用方法

### 1. 安装依赖

本项目依赖 `chardet` 库用于自动检测文件编码。可以使用以下命令安装依赖：

```bash
pip install -r requirements.txt
```

或者直接安装：

```bash
pip install chardet==5.2.0
```

### 2. 命令行使用

最简单的使用方式是直接将账单文件路径作为参数：

```bash
python main.py 账单文件.csv
```

#### 完整命令行参数

```bash
python main.py [账单文件路径] [-t 账单类型] [-o 输出文件路径]
```

- **账单文件路径**：直接作为位置参数传入，最简单的用法
- **-t, --type**：账单类型，可选 `alipay`（支付宝，默认）或 `weixin`（微信支付）
- **-i, --input**：输入文件路径（与位置参数功能相同，二选一使用）
- **-o, --output**：输出文件路径（可选，默认在输入文件同目录下创建"原文件名_处理后.csv"）

#### 使用示例

处理支付宝账单（默认类型为 alipay）：
```bash
# 最简单用法
python main.py 支付宝交易明细.csv

# 指定输出文件
python main.py 支付宝交易明细.csv -o 导出结果.csv
```

处理微信账单：
```bash
# 指定账单类型为微信
python main.py 微信支付账单.csv -t weixin

# 使用选项指定输入和输出
python main.py -t weixin -i 微信支付账单.csv -o 微信账单_导出.csv
```

从标准输入处理数据：
```bash
cat 支付宝交易明细.csv | python main.py -t alipay
```

### 3. 文件处理说明

#### 支付宝账单处理
- 自动跳过前 24 行（文件说明、表头等）
- 自动识别交易状态、收支类型和金额列
- 过滤"不计收支"和"交易关闭"的记录
- 将"支出"转为负数金额

#### 微信账单处理
- 自动跳过前 16 行（文件说明、表头等）
- 自动识别交易时间、收/支类型、金额和状态列
- 过滤"已全额退款"、"提现已到账"、"对方已退还"等记录
- 将"支出"转为负数金额，处理¥符号和逗号

## 适用场景

- 将支付宝/微信账单数据导入 MoneyWiz、随手记等记账软件
- 批量清洗和格式化账单数据进行个人财务分析
- 自动化处理定期导出的账单报表

## License

MIT
